{"title":"YApi平台以及pm2管理","date":"2020-04-10T23:05:02.000Z","date_formatted":{"ll":"Apr 11, 2020","L":"04/11/2020","MM-DD":"04-11"},"link":"Learning/f360ef90efef","tags":["MongoDB","Node","YApi","pm2"],"categories":["Learning"],"updated":"2023-11-14T12:07:06.466Z","content":"<p>这是我做毕业设计时，特意单独用的一台服务器使用YApi平台管理接口。原来一直担心误删库，我的接口文档就全没了嘛，何况服务器上还托管了其他项目的接口。</p>\n<p>发现服务器突然宕机了！！！平台访问不了。吓死人了，我赶紧登上服务器，将YApi重启了，万幸数据都在！</p>\n <span id=\"more\"></span>\n<h2 id=\"一、yapi安装和使用\">一、YApi安装和使用<a title=\"#一、yapi安装和使用\" href=\"#一、yapi安装和使用\"></a></h2>\n<p><strong>暂时不写使用教程</strong></p>\n<p>以下复制粘贴的官网<strong>安装</strong>教程</p>\n<h4 id=\"环境要求\">环境要求<a title=\"#环境要求\" href=\"#环境要求\"></a></h4>\n<ul>\n<li>nodejs（7.6+)</li>\n<li>mongodb（2.6+）</li>\n<li>git</li>\n</ul>\n<h4 id=\"安装\">安装<a title=\"#安装\" href=\"#安装\"></a></h4>\n<p>使用我们提供的 yapi-cli 工具，部署 YApi 平台是非常容易的。执行 yapi server 启动可视化部署程序，输入相应的配置和点击开始部署，就能完成整个网站的部署。部署完成之后，可按照提示信息，执行 node/{网站路径/server/app.js} 启动服务器。在浏览器打开指定url, 点击登录输入您刚才设置的管理员邮箱，默认密码为 <a href=\"http://ymfe.org\">ymfe.org</a> 登录系统（默认密码可在个人中心修改）。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g yapi-cli --registry https://registry.npm.taobao.org</span><br><span class=\"line\">yapi server </span><br></pre></td></tr></table></figure>\n<h4 id=\"服务管理\">服务管理<a title=\"#服务管理\" href=\"#服务管理\"></a></h4>\n<p>利用pm2方便服务管理维护。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install pm2 -g  //安装pm2</span><br><span class=\"line\">cd  &#123;项目目录&#125;</span><br><span class=\"line\">pm2 start &quot;vendors/server/app.js&quot; --name yapi //pm2管理yapi服务</span><br><span class=\"line\">pm2 info yapi //查看服务信息</span><br><span class=\"line\">pm2 stop yapi //停止服务</span><br><span class=\"line\">pm2 restart yapi //重启服务</span><br></pre></td></tr></table></figure>\n<h4 id=\"升级\">升级<a title=\"#升级\" href=\"#升级\"></a></h4>\n<p>升级项目版本是非常容易的，并且不会影响已有的项目数据，只会同步 vendors 目录下的源码文件。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd  &#123;项目目录&#125;</span><br><span class=\"line\">yapi ls //查看版本号列表</span><br><span class=\"line\">yapi update //更新到最新版本</span><br><span class=\"line\">yapi update -v &#123;Version&#125; //更新到指定版本</span><br></pre></td></tr></table></figure>\n<h2 id=\"二、mongodb数据库备份\">二、MongoDB数据库备份<a title=\"#二、mongodb数据库备份\" href=\"#二、mongodb数据库备份\"></a></h2>\n<p>暂时未详细研究</p>\n<h4 id=\"备份：mongodump\">备份：mongodump<a title=\"#备份：mongodump\" href=\"#备份：mongodump\"></a></h4>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongodump -h &lt;hostname&gt;&lt;:port&gt; -d dbname -o &lt;path&gt;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>-h：MongDB所在服务器地址，如：127.0.0.1:27017</li>\n<li>-d：需要备份的数据库实例，如：test</li>\n<li>-o：输出目录，例如：/home/mongodb.bat/(该目录需要提前建立)，在备份完成/home/mongodb.bat/test/</li>\n</ul>\n<h4 id=\"恢复：mongorestore\">恢复：mongorestore<a title=\"#恢复：mongorestore\" href=\"#恢复：mongorestore\"></a></h4>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongorestore -h &lt;hostname&gt;&lt;:port&gt; -d dbname &lt;path&gt;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>-h：MongoDB所在服务器地址，默认为： localhost:27017</p>\n</li>\n<li>\n<p>-d：恢复数据库实例名称</p>\n</li>\n<li>\n<p>–drop：恢复的时候，先删除当前数据，然后恢复备份的数据</p>\n</li>\n<li>\n<p><path>：最后的一个参数，设置备份数据所在位置，例如：/home/mongodb.bat/test/</p>\n<blockquote>\n<p>–dir：指定备份的目录。<strong>你不能同时指定 <path> 和 --dir 选项。</strong></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"三、pm2对node进程管理\">三、PM2对Node进程管理<a title=\"#三、pm2对node进程管理\" href=\"#三、pm2对node进程管理\"></a></h2>\n<blockquote>\n<p>参考自：<a href=\"https://pm2.keymetrics.io/docs/usage/quick-start/\">https://pm2.keymetrics.io/docs/usage/quick-start/</a></p>\n</blockquote>\n<p>安装：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install pm2@latest -g</span><br></pre></td></tr></table></figure>\n<p>添加node应用：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm2 start app.js --name &lt;app_name&gt; --watch</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>例：pm2 start “vendors/server/app.js” --name yapi</p>\n</blockquote>\n<ul>\n<li>–name：给应用命名，可以不管</li>\n<li>–watch：相当于热更新，应用文件更新后会重启应用</li>\n</ul>\n<p>其他命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm2 [list|ls|status]  #查看所有应用</span><br><span class=\"line\">pm2 info app_name         #查看服务信息</span><br><span class=\"line\">pm2 restart app_name  #重启</span><br><span class=\"line\">pm2 reload app_name   #重载</span><br><span class=\"line\">pm2 stop app_name     #停止</span><br><span class=\"line\">pm2 delete app_name   #从pm2移除</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>app_name：可以用id代替，其中all表示所有进程</p>\n</blockquote>\n","prev":{"title":"TypeScript学习-数据类型","link":"Learning/d4c7cbf3ff66"},"next":{"title":"Laravel常用命令","link":"Learning/05e70c5ba457"},"plink":"https://blog.jschef.com/Learning/f360ef90efef/","toc":[{"id":"一、yapi安装和使用","title":"一、YApi安装和使用","index":"1"},{"id":"二、mongodb数据库备份","title":"二、MongoDB数据库备份","index":"2"},{"id":"三、pm2对node进程管理","title":"三、PM2对Node进程管理","index":"3"}],"reward":true,"copyright":{"author":"Chef Wu","link":"<a href=\"https://blog.jschef.com/Learning/f360ef90efef/\" title=\"YApi平台以及pm2管理\">https://blog.jschef.com/Learning/f360ef90efef/</a>","license":"自由转载-非商用-禁止演绎-保持署名 (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"April 11, 2020"}}