{"title":"Nginx站点配置","date":"2019-08-13T01:11:42.000Z","date_formatted":{"ll":"Aug 13, 2019","L":"08/13/2019","MM-DD":"08-13"},"link":"Learning/a6fb2798339e","tags":["Nginx","PHP"],"categories":["Learning"],"updated":"2023-11-14T12:07:06.466Z","content":"<h2 id=\"一、域名解析\">一、域名解析<a title=\"#一、域名解析\" href=\"#一、域名解析\"></a></h2>\n<p>  在配置站点之前，先到自己购买的域名页面，将域名A解析到我们服务器的公网IP。</p>\n<h2 id=\"二、找到默认配置文件\">二、找到默认配置文件<a title=\"#二、找到默认配置文件\" href=\"#二、找到默认配置文件\"></a></h2>\n<p>  之前安装完成了LNMP环境，现在开始配置站点了。首先是找到nginx默认的配置文件default，在 <code>/etc/nginx/sites-enabled/</code> 目录下。我们将它复制到 <code>/etc/nginx/conf.d/</code> ，并更改名为 <code>yousite.com.conf</code> 。这样改名的好处就是以后一目了然那个站点对应那个配置文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cp</span> /etc/nginx/sites-enabled/default /etc/nginx/conf.d/www.zzboy.cn.conf</span><br></pre></td></tr></table></figure>\n<p>  另外我们还需要将nginx默认站点给去掉，编辑 <code>/etc/nginx/nginx.conf</code> 文件，找到 <code>include /etc/nginx/sites-enabled/*;</code> 将其注释掉。当然也可以选择忽略此步，不关闭这个apache2默认站点。我们可以注意到，这个配置文件中这两行可以加载conf.d目录下的所有以.conf为后缀的文件和sites-enabled下的所有配置文件。我们直接注释掉这个加载默认站点的语句，即可关闭默认站点。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/nginx/nginx.conf</span><br><span class=\"line\"></span><br><span class=\"line\">        include /etc/nginx/conf.d/*.conf;</span><br><span class=\"line\"><span class=\"comment\">#       include /etc/nginx/sites-enabled/*;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"三、配置文件\">三、配置文件<a title=\"#三、配置文件\" href=\"#三、配置文件\"></a></h2>\n<p>  打开我们的复制到conf.d目录下的配置文件，编辑它。以下就是默认配置文件的内容，我就在里面用注释简单说一下。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">##</span></span><br><span class=\"line\"><span class=\"comment\"># You should look at the following URL&#x27;s in order to grasp a solid understanding</span></span><br><span class=\"line\"><span class=\"comment\"># .....此处忽略一大堆注释</span></span><br><span class=\"line\"><span class=\"comment\"># Default server configuration</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        <span class=\"comment\"># 监听ipv4的80端口</span></span><br><span class=\"line\">        listen 80 default_server;</span><br><span class=\"line\">        <span class=\"comment\"># 监听ipv6的80端口</span></span><br><span class=\"line\">        listen [::]:80 default_server;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">#SSL证书配置，本段忽略，用Let&#x27;s Encrypt免费SSL证书可以自动配置</span></span><br><span class=\"line\">        <span class=\"comment\"># SSL configuration</span></span><br><span class=\"line\">        <span class=\"comment\"># .....此处忽略一大堆注释</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 站点目录：也就是你的网站源代码根目录</span></span><br><span class=\"line\">        root /var/www/html;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 入口页面，一般是index.html 或者 index.php，当然改成其他如home.php也行</span></span><br><span class=\"line\">        <span class=\"comment\"># Add index.php to the list if you are using PHP</span></span><br><span class=\"line\">        index index.html index.htm index.nginx-debian.html;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 服务器名称，这里就是绑定域名，_表示不用域名，ip直接访问</span></span><br><span class=\"line\">        server_name _;</span><br><span class=\"line\">        <span class=\"comment\"># 网站404文件路径配置</span></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">                <span class=\"comment\"># First attempt to serve request as file, then</span></span><br><span class=\"line\">                <span class=\"comment\"># as directory, then fall back to displaying a 404.</span></span><br><span class=\"line\">                try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ =404;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\"># php文件解析设置</span></span><br><span class=\"line\">        <span class=\"comment\"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class=\"line\">        <span class=\"comment\"># 我们用php就需要把下面注释去掉</span></span><br><span class=\"line\">        <span class=\"comment\">#location ~ \\.php$ &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">#       include snippets/fastcgi-php.conf;</span></span><br><span class=\"line\">        <span class=\"comment\">#       # 用原生php-cgi管理</span></span><br><span class=\"line\">        <span class=\"comment\">#       # With php7.0-cgi alone:</span></span><br><span class=\"line\">        <span class=\"comment\">#       fastcgi_pass 127.0.0.1:9000;</span></span><br><span class=\"line\">        <span class=\"comment\">#       # 用php-fpm管理，两者只能选一</span></span><br><span class=\"line\">        <span class=\"comment\">#       # With php7.0-fpm:</span></span><br><span class=\"line\">        <span class=\"comment\">#       fastcgi_pass unix:/run/php/php7.0-fpm.sock;</span></span><br><span class=\"line\">        <span class=\"comment\">#&#125;</span></span><br><span class=\"line\">        <span class=\"comment\"># 阻止apache站点的配置文件.htaccess。</span></span><br><span class=\"line\">        <span class=\"comment\"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class=\"line\">        <span class=\"comment\"># concurs with nginx&#x27;s one</span></span><br><span class=\"line\">        <span class=\"comment\"># 我们这是nginx服务器，可能你上传的站点以前是apache的，这里是避免不必要的问题需要将下面注释去掉</span></span><br><span class=\"line\">        <span class=\"comment\">#location ~ /\\.ht &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">#       deny all;</span></span><br><span class=\"line\">        <span class=\"comment\">#&#125;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 这下面就是给的一个配置简单例子。</span></span><br><span class=\"line\"><span class=\"comment\"># Virtual Host configuration for example.com</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># You can move that to a different file under sites-available/ and symlink that</span></span><br><span class=\"line\"><span class=\"comment\"># to sites-enabled/ to enable it.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#server &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#       listen 80;</span></span><br><span class=\"line\"><span class=\"comment\">#       listen [::]:80;</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#       server_name example.com;</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#       root /var/www/example.com;</span></span><br><span class=\"line\"><span class=\"comment\">#       index index.html;</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#       location / &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#               try_files $uri $uri/ =404;</span></span><br><span class=\"line\"><span class=\"comment\">#       &#125;</span></span><br><span class=\"line\"><span class=\"comment\">#&#125;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"四、我们的配置\">四、我们的配置<a title=\"#四、我们的配置\" href=\"#四、我们的配置\"></a></h2>\n<p>  上面不懂没关系，可以直接拿走下面的用，一下以站点www.zzboy.cn配置为例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#config for www.zzboy.cn</span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen 80;</span><br><span class=\"line\">        <span class=\"comment\"># listen [::]:80; #服务器没有ipv6地址就不用监听了</span></span><br><span class=\"line\">        root /home/www.zzboy.cn; <span class=\"comment\">#站点目录名www.zzboy.cn，方便管理</span></span><br><span class=\"line\">        <span class=\"comment\"># 首页，入口页</span></span><br><span class=\"line\">        index index.html index.htm index.php;</span><br><span class=\"line\">        <span class=\"comment\"># 绑定域名</span></span><br><span class=\"line\">        server_name www.zzboy.cn;</span><br><span class=\"line\">        <span class=\"comment\"># 404 路径</span></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">                try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ =404;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\"># php管理，我们是7.2，一般都是在/run/php/下</span></span><br><span class=\"line\">        location ~ \\.php$ &#123;</span><br><span class=\"line\">                include snippets/fastcgi-php.conf;</span><br><span class=\"line\">        <span class=\"comment\">#       # With php7.0-cgi alone:</span></span><br><span class=\"line\">        <span class=\"comment\">#       fastcgi_pass 127.0.0.1:9000;</span></span><br><span class=\"line\">        <span class=\"comment\">#       # With php7.0-fpm:</span></span><br><span class=\"line\">                fastcgi_pass unix:/run/php/php7.2-fpm.sock;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\"># 阻止.htaccess</span></span><br><span class=\"line\">        location ~ /\\.ht &#123;</span><br><span class=\"line\">                deny all;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  配置完成后，保存退出。重新加载nginx，重载配置文件前，要确认存在站点目录，否者会报错。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl reload nginx</span><br><span class=\"line\"><span class=\"comment\">#如果报错，可用以下命令查看错误</span></span><br><span class=\"line\">nginx -t</span><br></pre></td></tr></table></figure>\n<p>  现在可以用在浏览器输入域名访问了。</p>\n<h2 id=\"五、多站点配置\">五、多站点配置<a title=\"#五、多站点配置\" href=\"#五、多站点配置\"></a></h2>\n<p>  多站点配置很简单，下面我以第二个站点为blog.zzboy.cn进行配置。</p>\n<ul>\n<li>同样先将网站2的域名A解析到服务器公网IP。</li>\n<li>复制之前配置好的文件</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cp</span> /etc/nginx/conf.d/www.zzboy.cn.conf /etc/nginx/conf.d/blog.zzboy.cn.conf</span><br></pre></td></tr></table></figure>\n<ul>\n<li>打开blog.zzboy.cn.conf，只需要改两处（站点目录和域名绑定）就行了：</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#config for blog.zzboy.cn</span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen 80;</span><br><span class=\"line\">        <span class=\"comment\"># listen [::]:80; #服务器没有ipv6地址就不用监听了</span></span><br><span class=\"line\">        root /home/blog.zzboy.cn; <span class=\"comment\">#站点目录名blog.zzboy.cn，方便管理</span></span><br><span class=\"line\">        <span class=\"comment\"># 首页，入口页</span></span><br><span class=\"line\">        index index.html index.htm index.php;</span><br><span class=\"line\">        <span class=\"comment\"># 绑定域名</span></span><br><span class=\"line\">        server_name blog.zzboy.cn;</span><br><span class=\"line\">        <span class=\"comment\"># 404 路径</span></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">                try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ =404;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\"># php管理，我们是7.2，一般都是在/run/php/下</span></span><br><span class=\"line\">        location ~ \\.php$ &#123;</span><br><span class=\"line\">                include snippets/fastcgi-php.conf;</span><br><span class=\"line\">        <span class=\"comment\">#       # With php7.0-cgi alone:</span></span><br><span class=\"line\">        <span class=\"comment\">#       fastcgi_pass 127.0.0.1:9000;</span></span><br><span class=\"line\">        <span class=\"comment\">#       # With php7.0-fpm:</span></span><br><span class=\"line\">                fastcgi_pass unix:/run/php/php7.2-fpm.sock;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\"># 阻止.htaccess</span></span><br><span class=\"line\">        location ~ /\\.ht &#123;</span><br><span class=\"line\">                deny all;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  配置完成后，保存退出。重新加载nginx：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl reload nginx</span><br></pre></td></tr></table></figure>\n<p>  现在在浏览器访问第二个站点了。</p>\n<h2 id=\"六、有个小疑问\">六、有个小疑问<a title=\"#六、有个小疑问\" href=\"#六、有个小疑问\"></a></h2>\n<p>  配置多站点后，只能有一个站点可用default_server，为啥？</p>\n","prev":{"title":"Nginx用certbot获取Let's Encrypt SSL证书","link":"Learning/97cad6591dc5"},"next":{"title":"Ubuntu 16.04搭建lnmp环境","link":"Learning/1e8a589a019b"},"plink":"https://blog.jschef.com/Learning/a6fb2798339e/","toc":[{"id":"一、域名解析","title":"一、域名解析","index":"1"},{"id":"二、找到默认配置文件","title":"二、找到默认配置文件","index":"2"},{"id":"三、配置文件","title":"三、配置文件","index":"3"},{"id":"四、我们的配置","title":"四、我们的配置","index":"4"},{"id":"五、多站点配置","title":"五、多站点配置","index":"5"},{"id":"六、有个小疑问","title":"六、有个小疑问","index":"6"}],"reward":true,"copyright":{"author":"Chef Wu","link":"<a href=\"https://blog.jschef.com/Learning/a6fb2798339e/\" title=\"Nginx站点配置\">https://blog.jschef.com/Learning/a6fb2798339e/</a>","license":"自由转载-非商用-禁止演绎-保持署名 (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"August 13, 2019"}}